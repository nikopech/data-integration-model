) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
# clean environment ------
rm(list = ls())
gc()
# load libraries ---------------
library(devtools)
library(enrichR)
library(data.table)
library(stringr)
# initialization ----------
# listEnrichrSites()
setEnrichrSite("Enrichr")
websiteLive <- TRUE
# dbs <- listEnrichrDbs()
# user defined inputs -------------------
# choose Enrich data base to query
db = "KEGG_2019_Human"
# input file
input_file = "feature-counts.txt"
# filter absolute difference
filt = 0.05
# enrichr analysis --------------------------
my_data = fread(input_file, sep = "\t")
genes <- my_data$Geneid
# query
if (websiteLive) {
enriched <- enrichr(genes, db)
}
for(i in names(enriched)) {
print('#######')
print(names(enriched))
print('****')
#print(enriched[[i]])
tmp = enriched[[i]]
tmp = setDT(tmp)
tmp = tmp[which(tmp$P.value <= 0.05), ]
message(c(
"Number of significant pathways found for ",
i, ": ",
nrow(tmp)
))
if(nrow(tmp) > 0) {
fwrite(
tmp,
paste0(i, "-enriched.txt"),
row.names = FALSE,
quote = FALSE,
sep = "\t"
)
}
}
# proportional normalization ------------------
my_data$CTL_S1_norm = 100 * my_data$CTL_S1.sorted.bam / sum(my_data$CTL_S1.sorted.bam)
my_data$DOX_POS_S3_norm = 100 * my_data$DOX_POS_S3.sorted.bam / sum(my_data$DOX_POS_S3.sorted.bam)
my_data$`Abs Diff` = abs(my_data$CTL_S1_norm - my_data$DOX_POS_S3_norm) / 100
my_data = my_data[order(-`Abs Diff`), ]
# visualization -----------------------------
library(ggplot2)
library(ggrepel)
my_data$xorder = 1:nrow(my_data)
label_data = my_data[which(my_data$`Abs Diff` > 0.02), ]
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 0.5
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
label_data$x1 = label_data$CTL_S1_norm / 100
label_data$x2 = -label_data$DOX_POS_S3_norm / 100
label_data = label_data[order(label_data$`Abs Diff`), ]
label_data$Geneid = factor(
label_data$Geneid,
levels = label_data$Geneid
)
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
# clean environment ------
rm(list = ls())
gc()
# load libraries ---------------
library(devtools)
library(enrichR)
library(data.table)
library(stringr)
# initialization ----------
# listEnrichrSites()
setEnrichrSite("Enrichr")
websiteLive <- TRUE
# dbs <- listEnrichrDbs()
# user defined inputs -------------------
# choose Enrich data base to query
db = "KEGG_2019_Human"
# input file
input_file = "feature-counts.txt"
# filter absolute difference
filt = 0.05
# enrichr analysis --------------------------
my_data = fread(input_file, sep = "\t")
genes <- my_data$Geneid
# query
if (websiteLive) {
enriched <- enrichr(genes, db)
}
for(i in names(enriched)) {
print('#######')
print(names(enriched))
print('****')
print(i)
print('---------')
print(enriched[[1]])
tmp = enriched[[i]]
tmp = setDT(tmp)
tmp = tmp[which(tmp$P.value <= 0.05), ]
message(c(
"Number of significant pathways found for ",
i, ": ",
nrow(tmp)
))
if(nrow(tmp) > 0) {
fwrite(
tmp,
paste0(i, "-enriched.txt"),
row.names = FALSE,
quote = FALSE,
sep = "\t"
)
}
}
# proportional normalization ------------------
my_data$CTL_S1_norm = 100 * my_data$CTL_S1.sorted.bam / sum(my_data$CTL_S1.sorted.bam)
my_data$DOX_POS_S3_norm = 100 * my_data$DOX_POS_S3.sorted.bam / sum(my_data$DOX_POS_S3.sorted.bam)
my_data$`Abs Diff` = abs(my_data$CTL_S1_norm - my_data$DOX_POS_S3_norm) / 100
my_data = my_data[order(-`Abs Diff`), ]
# visualization -----------------------------
library(ggplot2)
library(ggrepel)
my_data$xorder = 1:nrow(my_data)
label_data = my_data[which(my_data$`Abs Diff` > 0.02), ]
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 0.5
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
label_data$x1 = label_data$CTL_S1_norm / 100
label_data$x2 = -label_data$DOX_POS_S3_norm / 100
label_data = label_data[order(label_data$`Abs Diff`), ]
label_data$Geneid = factor(
label_data$Geneid,
levels = label_data$Geneid
)
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
View(enriched)
y = c(4,12,6,7,2,9,5)
order(y)
y[order(y)]
y[order(-y)]
# clean environment ------
rm(list = ls())
gc()
# load libraries ---------------
library(devtools)
library(enrichR)
library(data.table)
library(stringr)
# initialization ----------
# listEnrichrSites()
setEnrichrSite("Enrichr")
websiteLive <- TRUE
# dbs <- listEnrichrDbs()
# user defined inputs -------------------
# choose Enrich data base to query
db = "KEGG_2019_Human"
# input file
input_file = "feature-counts.txt"
# filter absolute difference
filt = 0.05
# enrichr analysis --------------------------
my_data = fread(input_file, sep = "\t")
genes <- my_data$Geneid
# query
if (websiteLive) {
enriched <- enrichr(genes, db)
}
for(i in names(enriched)) {
tmp = enriched[[i]]
tmp = setDT(tmp)
tmp = tmp[which(tmp$P.value <= 0.05), ]
message(c(
"Number of significant pathways found for ",
i, ": ",
nrow(tmp)
))
if(nrow(tmp) > 0) {
fwrite(
tmp,
paste0(i, "-enriched.txt"),
row.names = FALSE,
quote = FALSE,
sep = "\t"
)
}
}
# proportional normalization ------------------
my_data$CTL_S1_norm = 100 * my_data$CTL_S1.sorted.bam / sum(my_data$CTL_S1.sorted.bam)
my_data$DOX_POS_S3_norm = 100 * my_data$DOX_POS_S3.sorted.bam / sum(my_data$DOX_POS_S3.sorted.bam)
my_data$`Abs Diff` = abs(my_data$CTL_S1_norm - my_data$DOX_POS_S3_norm) / 100
my_data = my_data[order(-`Abs Diff`), ]
# visualization -----------------------------
library(ggplot2)
library(ggrepel)
my_data$xorder = 1:nrow(my_data)
label_data = my_data[which(my_data$`Abs Diff` > 0.02), ]
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 1.5
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
label_data$x1 = label_data$CTL_S1_norm / 100
label_data$x2 = -label_data$DOX_POS_S3_norm / 100
label_data = label_data[order(label_data$`Abs Diff`), ]
label_data$Geneid = factor(
label_data$Geneid,
levels = label_data$Geneid
)
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
# clean environment ------
rm(list = ls())
gc()
# load libraries ---------------
library(devtools)
library(enrichR)
library(data.table)
library(stringr)
# initialization ----------
# listEnrichrSites()
setEnrichrSite("Enrichr")
websiteLive <- TRUE
# dbs <- listEnrichrDbs()
# user defined inputs -------------------
# choose Enrich data base to query
db = "KEGG_2019_Human"
# input file
input_file = "feature-counts.txt"
# filter absolute difference
filt = 0.05
# enrichr analysis --------------------------
my_data = fread(input_file, sep = "\t")
genes <- my_data$Geneid
# query
if (websiteLive) {
enriched <- enrichr(genes, db)
}
for(i in names(enriched)) {
tmp = enriched[[i]]
tmp = setDT(tmp)
tmp = tmp[which(tmp$P.value <= 0.05), ]
message(c(
"Number of significant pathways found for ",
i, ": ",
nrow(tmp)
))
if(nrow(tmp) > 0) {
fwrite(
tmp,
paste0(i, "-enriched.txt"),
row.names = FALSE,
quote = FALSE,
sep = "\t"
)
}
}
# proportional normalization ------------------
my_data$CTL_S1_norm = 100 * my_data$CTL_S1.sorted.bam / sum(my_data$CTL_S1.sorted.bam)
my_data$DOX_POS_S3_norm = 100 * my_data$DOX_POS_S3.sorted.bam / sum(my_data$DOX_POS_S3.sorted.bam)
my_data$`Abs Diff` = abs(my_data$CTL_S1_norm - my_data$DOX_POS_S3_norm) / 100
my_data = my_data[order(-`Abs Diff`), ]
# visualization -----------------------------
library(ggplot2)
library(ggrepel)
my_data$xorder = 1:nrow(my_data)
label_data = my_data[which(my_data$`Abs Diff` > 0.02), ]
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 0.05
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
label_data$x1 = label_data$CTL_S1_norm / 100
label_data$x2 = -label_data$DOX_POS_S3_norm / 100
label_data = label_data[order(label_data$`Abs Diff`), ]
label_data$Geneid = factor(
label_data$Geneid,
levels = label_data$Geneid
)
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
View(my_data)
# clean environment ------
rm(list = ls())
gc()
# load libraries ---------------
library(devtools)
library(enrichR)
library(data.table)
library(stringr)
# initialization ----------
# listEnrichrSites()
setEnrichrSite("Enrichr")
websiteLive <- TRUE
# dbs <- listEnrichrDbs()
# user defined inputs -------------------
# choose Enrich data base to query
db = "KEGG_2019_Human"
# input file
input_file = "feature-counts.txt"
# filter absolute difference
filt = 0.05
# enrichr analysis --------------------------
my_data = fread(input_file, sep = "\t")
genes <- my_data$Geneid
# query
if (websiteLive) {
enriched <- enrichr(genes, db)
}
for(i in names(enriched)) {
tmp = enriched[[i]]
tmp = setDT(tmp)
tmp = tmp[which(tmp$P.value <= 0.05), ]
message(c(
"Number of significant pathways found for ",
i, ": ",
nrow(tmp)
))
if(nrow(tmp) > 0) {
fwrite(
tmp,
paste0(i, "-enriched.txt"),
row.names = FALSE,
quote = FALSE,
sep = "\t"
)
}
}
# proportional normalization ------------------
my_data$CTL_S1_norm = 100 * my_data$CTL_S1.sorted.bam / sum(my_data$CTL_S1.sorted.bam)
my_data$DOX_POS_S3_norm = 100 * my_data$DOX_POS_S3.sorted.bam / sum(my_data$DOX_POS_S3.sorted.bam)
my_data$`Abs Diff` = abs(my_data$CTL_S1_norm - my_data$DOX_POS_S3_norm) / 100
my_data = my_data[order(-`Abs Diff`), ]
# visualization -----------------------------
library(ggplot2)
library(ggrepel)
my_data$xorder = 1:nrow(my_data)
label_data = my_data[which(my_data$`Abs Diff` > 0.02), ]
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 0.5
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
label_data$x1 = label_data$CTL_S1_norm / 100 #giati to ksanadiairei
label_data$x2 = -label_data$DOX_POS_S3_norm / 100
label_data = label_data[order(label_data$`Abs Diff`), ]
label_data$Geneid = factor(
label_data$Geneid,
levels = label_data$Geneid
)
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
tmp = enriched[[i]]
tmp = setDT(tmp)
print(tmp)
ggplot(my_data, aes(x = xorder, y = `Abs Diff`)) +
geom_text_repel(data = label_data,
aes(x = xorder, y = `Abs Diff`, label = Geneid),
min.segment.length = 0) +
geom_point(
alpha = 0.5
) +
scale_x_continuous(trans = "log10") +
scale_y_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(x = "Gene order from maximum to minimum absolute difference",
title = "CTL_S1 - DOX_POS_S3")
ggplot(data = label_data) +
geom_col(aes(x = x1, y = Geneid), fill = "gray40") +
geom_col(aes(x = x2, y  = Geneid), fill = "gray70") +
geom_vline(xintercept = 0, color = "white")+
scale_x_continuous(labels = scales::percent) +
theme_minimal() +
theme(
panel.grid.minor = element_blank()
) +
labs(
x = "Proportional expression",
title = "DOX_POS_S3 - CTL_S1"
)
getwd()
setwd("~/R_test/InterTADs")
getwd()
usethis::create_package("/Users/aspaor/R_test/InterTADs")
usethis::create_package("/Users/aspaor/R_test/InterTADs")
